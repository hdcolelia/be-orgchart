// getting base64 icons
import { expandBase64Data } from './../../../assets/icons/expand.base64';
import { collapseBase64Data } from './../../../assets/icons/collapse.base64';
import { errorBase64Data } from './../../../assets/icons/error.base64';
export class D3NodeBasicParser {
    constructor() {
        // dimensions
        this.width = 220;
        this.height = 80;
        // expand / colapse icons
        this.expandBase64Icon = expandBase64Data;
        this.collapseBase64Icon = collapseBase64Data;
        // error icon
        this.errorBase64Icon = errorBase64Data;
        this.imageDefs = {
            x: -20, y: -15, h: 60, w: 60, rx: 6
        };
        this.transitionDuration = 500;
    }
    addImage() {
    }
    drawNodes(prGroup) {
        const me = this;
        // adding rect
        prGroup.append('rect').attr('class', 'node-rect')
            .attr('width', me.width).attr('height', me.height)
            .attr('stroke', 'blue').attr('stroke-width', 1)
            .attr('fill', '#02B2AC').attr('rx', 12);
        // adding title
        prGroup.append('text').text(d => d.data.title)
            .attr('font-size', 15).attr('x', 50).attr('y', 25);
        // adding description
        prGroup.append('text').text(d => d.data.description)
            .attr('font-size', 10).attr('x', 50).attr('y', 45);
        // prGroup.
        const imageData = (d) => {
            let linkRef = '';
            if (!d.data.nodeImage)
                return linkRef;
            if (d.data.nodeImage.url)
                linkRef = d.data.nodeImage.url;
            if (d.data.nodeImage.icon)
                linkRef = d.data.nodeImage.icon;
            if (d.data.nodeImage.base64)
                linkRef = `data:image/png;base64,${d.data.nodeImage.base64}`;
            return linkRef;
        };
        prGroup.filter(d => imageData(d) != '')
            .append('defs').append('pattern')
            .attr('id', d => `img-${d.data.nodeId}`)
            .attr('width', 1)
            .attr('height', 1)
            .append('image')
            .attr('xlink:href', d => imageData(d))
            .attr('width', me.imageDefs.w)
            .attr('height', me.imageDefs.h)
            .attr('preserveAspectRatio', 'xMidYMin slice');
        // adding image
        prGroup.filter(d => imageData(d) != '')
            .append('rect').attr('class', 'node-image')
            .attr('x', me.imageDefs.x).attr('y', me.imageDefs.y)
            .attr('width', me.imageDefs.w).attr('height', me.imageDefs.h)
            // .attr('stroke', 'blue').attr('stroke-width', 1)
            .attr('fill', d => `url(#img-${d.data.nodeId})`).attr('rx', me.imageDefs.rx);
        // prGroup.each((d, i) => me.drawNode(d, i, prGroup));
    }
    drawNode(prData, prIndex, node) {
        const me = this;
        // adding rect
        console.log('Node: ', node.property('class'));
        node.append('rect').attr('class', 'node-rect')
            .attr('width', me.width).attr('height', me.height)
            .attr('stroke', 'blue').attr('stroke-width', 1)
            .attr('fill', '#02B2AC').attr('rx', 12);
        console.log('Adding text : ', prData.data.nodeId);
        // adding title
        node.append('text').text(d => d.data.title)
            .attr('font-size', 15).attr('x', 50).attr('y', 25);
        // adding description
        node.append('text').text(d => d.data.description)
            .attr('font-size', 10).attr('x', 50).attr('y', 45);
        // prGroup.
        if (prData.data.nodeImage) {
            const defs = node.append('defs').append('pattern')
                .attr('id', d => `img-${d.data.nodeId}`)
                .attr('width', 1)
                .attr('height', 1);
            let linkRef = '';
            if (prData.data.nodeImage.url)
                linkRef = prData.data.nodeImage.url;
            if (prData.data.nodeImage.icon)
                linkRef = prData.data.nodeImage.icon;
            if (prData.data.nodeImage.base64)
                linkRef = `data:image/png;base64,${prData.data.nodeImage.base64}`;
            const image = defs.append('image')
                .attr('xlink:href', linkRef)
                .attr('width', me.imageDefs.w)
                .attr('height', me.imageDefs.h)
                // .attr('viewbox', '0 0 100 100')
                .attr('preserveAspectRatio', 'xMidYMin slice');
            // adding image
            node.append('rect').attr('class', 'node-image')
                .attr('x', me.imageDefs.x).attr('y', me.imageDefs.y)
                .attr('width', me.imageDefs.w).attr('height', me.imageDefs.h)
                // .attr('stroke', 'blue').attr('stroke-width', 1)
                .attr('fill', d => `url(#img-${d.data.nodeId})`).attr('rx', me.imageDefs.rx);
        }
    }
    xxxdrawNodes(prGroup) {
        const me = this;
        prGroup
            .append('defs')
            .append('pattern')
            .attr('id', d => `img-${d.data.nodeId}`)
            .attr('width', 70)
            .attr('height', 70)
            .append('image')
            .attr('xlink:href', d => d.data.nodeImage.url)
            .attr('width', 70)
            .attr('height', 70);
        // adding rect
        prGroup.append('rect').attr('class', 'node-rect')
            .attr('width', me.width).attr('height', me.height)
            .attr('stroke', 'blue').attr('stroke-width', 1)
            .attr('fill', 'gray').attr('rx', 12);
        // adding title
        prGroup.append('text').text(d => d.data.title)
            .attr('font-size', 10).attr('x', 70).attr('y', 25);
        // adding description
        prGroup.append('text').text(d => d.data.description)
            .attr('font-size', 10).attr('x', 70).attr('y', 45);
        // adding image
        prGroup.append('rect').attr('class', 'node-image')
            .attr('x', 5).attr('y', 10)
            .attr('width', 50).attr('height', 50)
            .attr('fill', d => `url(#img-${d.data.nodeId})`);
        // prGroup.
    }
    updateNodes(prGroup, prNodes) {
        prGroup.select('rect.node-rect').attr('fill', 'black');
        //  .each(d => {
        //    console.log('argument: ', d);
        //  })
        //.data(prNodes).select('rect.node-rect')
        //.attr('x', d => d.x)
        //.attr('y', d => d.y);
        // console.log('Updateing...:', prGroup)
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS1iYXNpYy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2JlLW9yZ2NoYXJ0LyIsInNvdXJjZXMiOlsibGliL2NsYXNlc3MvQGl0ZW1zL2Jhc2ljL25vZGUtYmFzaWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsdUJBQXVCO0FBQ3ZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQ3pFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUV2RSxNQUFNLE9BQU8saUJBQWlCO0lBQzVCO1FBQ0EsYUFBYTtRQUNiLFVBQUssR0FBVyxHQUFHLENBQUM7UUFDcEIsV0FBTSxHQUFXLEVBQUUsQ0FBQztRQUVwQix5QkFBeUI7UUFDekIscUJBQWdCLEdBQUcsZ0JBQWdCLENBQUM7UUFDcEMsdUJBQWtCLEdBQUcsa0JBQWtCLENBQUM7UUFFeEMsYUFBYTtRQUNiLG9CQUFlLEdBQUcsZUFBZSxDQUFDO1FBRWxDLGNBQVMsR0FBK0Q7WUFDdEUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7U0FDcEMsQ0FBQTtRQUVELHVCQUFrQixHQUFXLEdBQUcsQ0FBQztJQWhCakIsQ0FBQztJQWtCUCxRQUFRO0lBRWxCLENBQUM7SUFFRCxTQUFTLENBQ1AsT0FBNEU7UUFFNUUsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBRWhCLGNBQWM7UUFDZCxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDO2FBQzlDLElBQUksQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBRSxD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UUFDekMsc0JBQXNCO1FBQ3RCLHVCQUF1QjtRQUN2Qix3Q0FBd0M7SUFDMUMsQ0FBQztDQUVGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgZDMgZnJvbSAnZDMnO1xyXG5pbXBvcnQgeyBJRDNOb2RlIH0gZnJvbSAnLi8uLi8uLi8uLi9pbnRlcmZhY2VzJztcclxuXHJcbi8vIGdldHRpbmcgYmFzZTY0IGljb25zXHJcbmltcG9ydCB7IGV4cGFuZEJhc2U2NERhdGEgfSBmcm9tICcuLy4uLy4uLy4uL2Fzc2V0cy9pY29ucy9leHBhbmQuYmFzZTY0JztcclxuaW1wb3J0IHsgY29sbGFwc2VCYXNlNjREYXRhIH0gZnJvbSAnLi8uLi8uLi8uLi9hc3NldHMvaWNvbnMvY29sbGFwc2UuYmFzZTY0JztcclxuaW1wb3J0IHsgZXJyb3JCYXNlNjREYXRhIH0gZnJvbSAnLi8uLi8uLi8uLi9hc3NldHMvaWNvbnMvZXJyb3IuYmFzZTY0JztcclxuXHJcbmV4cG9ydCBjbGFzcyBEM05vZGVCYXNpY1BhcnNlciB7XHJcbiAgY29uc3RydWN0b3IoKSB7IH1cclxuICAvLyBkaW1lbnNpb25zXHJcbiAgd2lkdGg6IG51bWJlciA9IDIyMDtcclxuICBoZWlnaHQ6IG51bWJlciA9IDgwO1xyXG5cclxuICAvLyBleHBhbmQgLyBjb2xhcHNlIGljb25zXHJcbiAgZXhwYW5kQmFzZTY0SWNvbiA9IGV4cGFuZEJhc2U2NERhdGE7XHJcbiAgY29sbGFwc2VCYXNlNjRJY29uID0gY29sbGFwc2VCYXNlNjREYXRhO1xyXG5cclxuICAvLyBlcnJvciBpY29uXHJcbiAgZXJyb3JCYXNlNjRJY29uID0gZXJyb3JCYXNlNjREYXRhO1xyXG5cclxuICBpbWFnZURlZnM6IHsgeDogbnVtYmVyLCB5OiBudW1iZXIsIGg6IG51bWJlciwgdzogbnVtYmVyLCByeDogbnVtYmVyIH0gPSB7XHJcbiAgICB4OiAtMjAsIHk6IC0xNSwgaDogNjAsIHc6IDYwLCByeDogNlxyXG4gIH1cclxuXHJcbiAgdHJhbnNpdGlvbkR1cmF0aW9uOiBudW1iZXIgPSA1MDA7XHJcblxyXG4gIHByb3RlY3RlZCBhZGRJbWFnZSgpIHtcclxuXHJcbiAgfVxyXG5cclxuICBkcmF3Tm9kZXMoXHJcbiAgICBwckdyb3VwOiBkMy5TZWxlY3Rpb248U1ZHR0VsZW1lbnQsIGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPiwgYW55LCBhbnk+XHJcbiAgKSB7XHJcbiAgICBjb25zdCBtZSA9IHRoaXM7XHJcblxyXG4gICAgLy8gYWRkaW5nIHJlY3RcclxuICAgIHByR3JvdXAuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnbm9kZS1yZWN0JylcclxuICAgICAgLmF0dHIoJ3dpZHRoJywgbWUud2lkdGgpLmF0dHIoJ2hlaWdodCcsIG1lLmhlaWdodClcclxuICAgICAgLmF0dHIoJ3N0cm9rZScsICdibHVlJykuYXR0cignc3Ryb2tlLXdpZHRoJywgMSlcclxuICAgICAgLmF0dHIoJ2ZpbGwnLCAnIzAyQjJBQycpLmF0dHIoJ3J4JywgMTIpO1xyXG5cclxuICAgIC8vIGFkZGluZyB0aXRsZVxyXG4gICAgcHJHcm91cC5hcHBlbmQoJ3RleHQnKS50ZXh0KGQgPT4gZC5kYXRhLnRpdGxlKVxyXG4gICAgICAuYXR0cignZm9udC1zaXplJywgMTUpLmF0dHIoJ3gnLCA1MCkuYXR0cigneScsIDI1KTtcclxuXHJcbiAgICAvLyBhZGRpbmcgZGVzY3JpcHRpb25cclxuICAgIHByR3JvdXAuYXBwZW5kKCd0ZXh0JykudGV4dChkID0+IGQuZGF0YS5kZXNjcmlwdGlvbilcclxuICAgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIDEwKS5hdHRyKCd4JywgNTApLmF0dHIoJ3knLCA0NSk7XHJcbiAgICAvLyBwckdyb3VwLlxyXG4gICAgY29uc3QgaW1hZ2VEYXRhID0gKGQ6IGQzLkhpZXJhcmNoeVBvaW50Tm9kZTxJRDNOb2RlPikgPT4ge1xyXG4gICAgICBsZXQgbGlua1JlZjogc3RyaW5nID0gJydcclxuICAgICAgaWYgKCFkLmRhdGEubm9kZUltYWdlKSByZXR1cm4gbGlua1JlZjtcclxuXHJcbiAgICAgIGlmIChkLmRhdGEubm9kZUltYWdlLnVybCkgbGlua1JlZiA9IGQuZGF0YS5ub2RlSW1hZ2UudXJsO1xyXG4gICAgICBpZiAoZC5kYXRhLm5vZGVJbWFnZS5pY29uKSBsaW5rUmVmID0gZC5kYXRhLm5vZGVJbWFnZS5pY29uO1xyXG4gICAgICBpZiAoZC5kYXRhLm5vZGVJbWFnZS5iYXNlNjQpIGxpbmtSZWYgPSBgZGF0YTppbWFnZS9wbmc7YmFzZTY0LCR7ZC5kYXRhLm5vZGVJbWFnZS5iYXNlNjR9YDtcclxuICAgICAgcmV0dXJuIGxpbmtSZWY7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHByR3JvdXAuZmlsdGVyKGQgPT4gaW1hZ2VEYXRhKGQpICE9ICcnKVxyXG4gICAgICAuYXBwZW5kKCdkZWZzJykuYXBwZW5kKCdwYXR0ZXJuJylcclxuICAgICAgLmF0dHIoJ2lkJywgZCA9PiBgaW1nLSR7ZC5kYXRhLm5vZGVJZH1gKVxyXG4gICAgICAuYXR0cignd2lkdGgnLCAxKVxyXG4gICAgICAuYXR0cignaGVpZ2h0JywgMSlcclxuICAgICAgLmFwcGVuZCgnaW1hZ2UnKVxyXG4gICAgICAuYXR0cigneGxpbms6aHJlZicsIGQgPT4gaW1hZ2VEYXRhKGQpKVxyXG4gICAgICAuYXR0cignd2lkdGgnLCBtZS5pbWFnZURlZnMudylcclxuICAgICAgLmF0dHIoJ2hlaWdodCcsIG1lLmltYWdlRGVmcy5oKVxyXG4gICAgICAuYXR0cigncHJlc2VydmVBc3BlY3RSYXRpbycsICd4TWlkWU1pbiBzbGljZScpO1xyXG5cclxuICAgIC8vIGFkZGluZyBpbWFnZVxyXG4gICAgcHJHcm91cC5maWx0ZXIoZCA9PiBpbWFnZURhdGEoZCkgIT0gJycpXHJcbiAgICAgIC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdub2RlLWltYWdlJylcclxuICAgICAgLmF0dHIoJ3gnLCBtZS5pbWFnZURlZnMueCkuYXR0cigneScsIG1lLmltYWdlRGVmcy55KVxyXG4gICAgICAuYXR0cignd2lkdGgnLCBtZS5pbWFnZURlZnMudykuYXR0cignaGVpZ2h0JywgbWUuaW1hZ2VEZWZzLmgpXHJcbiAgICAgIC8vIC5hdHRyKCdzdHJva2UnLCAnYmx1ZScpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDEpXHJcbiAgICAgIC5hdHRyKCdmaWxsJywgZCA9PiBgdXJsKCNpbWctJHtkLmRhdGEubm9kZUlkfSlgKS5hdHRyKCdyeCcsIG1lLmltYWdlRGVmcy5yeCk7XHJcbiAgICAvLyBwckdyb3VwLmVhY2goKGQsIGkpID0+IG1lLmRyYXdOb2RlKGQsIGksIHByR3JvdXApKTtcclxuICB9XHJcblxyXG4gIGRyYXdOb2RlKHByRGF0YTogZDMuSGllcmFyY2h5UG9pbnROb2RlPElEM05vZGU+LCBwckluZGV4OiBudW1iZXIsIG5vZGU6IGQzLlNlbGVjdGlvbjxTVkdHRWxlbWVudCwgZDMuSGllcmFyY2h5UG9pbnROb2RlPElEM05vZGU+LCBhbnksIGFueT4pIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuXHJcbiAgICAvLyBhZGRpbmcgcmVjdFxyXG4gICAgY29uc29sZS5sb2coJ05vZGU6ICcsIG5vZGUucHJvcGVydHkoJ2NsYXNzJykpXHJcbiAgICBub2RlLmFwcGVuZCgncmVjdCcpLmF0dHIoJ2NsYXNzJywgJ25vZGUtcmVjdCcpXHJcbiAgICAgIC5hdHRyKCd3aWR0aCcsIG1lLndpZHRoKS5hdHRyKCdoZWlnaHQnLCBtZS5oZWlnaHQpXHJcbiAgICAgIC5hdHRyKCdzdHJva2UnLCAnYmx1ZScpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDEpXHJcbiAgICAgIC5hdHRyKCdmaWxsJywgJyMwMkIyQUMnKS5hdHRyKCdyeCcsIDEyKTtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnQWRkaW5nIHRleHQgOiAnLCBwckRhdGEuZGF0YS5ub2RlSWQpXHJcblxyXG4gICAgLy8gYWRkaW5nIHRpdGxlXHJcbiAgICBub2RlLmFwcGVuZCgndGV4dCcpLnRleHQoZCA9PiBkLmRhdGEudGl0bGUpXHJcbiAgICAgIC5hdHRyKCdmb250LXNpemUnLCAxNSkuYXR0cigneCcsIDUwKS5hdHRyKCd5JywgMjUpO1xyXG5cclxuICAgIC8vIGFkZGluZyBkZXNjcmlwdGlvblxyXG4gICAgbm9kZS5hcHBlbmQoJ3RleHQnKS50ZXh0KGQgPT4gZC5kYXRhLmRlc2NyaXB0aW9uKVxyXG4gICAgICAuYXR0cignZm9udC1zaXplJywgMTApLmF0dHIoJ3gnLCA1MCkuYXR0cigneScsIDQ1KTtcclxuICAgIC8vIHByR3JvdXAuXHJcblxyXG5cclxuICAgIGlmIChwckRhdGEuZGF0YS5ub2RlSW1hZ2UpIHtcclxuICAgICAgY29uc3QgZGVmcyA9IG5vZGUuYXBwZW5kKCdkZWZzJykuYXBwZW5kKCdwYXR0ZXJuJylcclxuICAgICAgICAuYXR0cignaWQnLCBkID0+IGBpbWctJHtkLmRhdGEubm9kZUlkfWApXHJcbiAgICAgICAgLmF0dHIoJ3dpZHRoJywgMSlcclxuICAgICAgICAuYXR0cignaGVpZ2h0JywgMSk7XHJcblxyXG4gICAgICBsZXQgbGlua1JlZjogc3RyaW5nID0gJydcclxuICAgICAgaWYgKHByRGF0YS5kYXRhLm5vZGVJbWFnZS51cmwpIGxpbmtSZWYgPSBwckRhdGEuZGF0YS5ub2RlSW1hZ2UudXJsO1xyXG4gICAgICBpZiAocHJEYXRhLmRhdGEubm9kZUltYWdlLmljb24pIGxpbmtSZWYgPSBwckRhdGEuZGF0YS5ub2RlSW1hZ2UuaWNvbjtcclxuICAgICAgaWYgKHByRGF0YS5kYXRhLm5vZGVJbWFnZS5iYXNlNjQpIGxpbmtSZWYgPSBgZGF0YTppbWFnZS9wbmc7YmFzZTY0LCR7cHJEYXRhLmRhdGEubm9kZUltYWdlLmJhc2U2NH1gO1xyXG5cclxuICAgICAgY29uc3QgaW1hZ2UgPSBkZWZzLmFwcGVuZCgnaW1hZ2UnKVxyXG4gICAgICAgIC5hdHRyKCd4bGluazpocmVmJywgbGlua1JlZilcclxuICAgICAgICAuYXR0cignd2lkdGgnLCBtZS5pbWFnZURlZnMudylcclxuICAgICAgICAuYXR0cignaGVpZ2h0JywgbWUuaW1hZ2VEZWZzLmgpXHJcbiAgICAgICAgLy8gLmF0dHIoJ3ZpZXdib3gnLCAnMCAwIDEwMCAxMDAnKVxyXG5cclxuICAgICAgICAuYXR0cigncHJlc2VydmVBc3BlY3RSYXRpbycsICd4TWlkWU1pbiBzbGljZScpO1xyXG4gICAgICAvLyBhZGRpbmcgaW1hZ2VcclxuICAgICAgbm9kZS5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdub2RlLWltYWdlJylcclxuICAgICAgICAuYXR0cigneCcsIG1lLmltYWdlRGVmcy54KS5hdHRyKCd5JywgbWUuaW1hZ2VEZWZzLnkpXHJcbiAgICAgICAgLmF0dHIoJ3dpZHRoJywgbWUuaW1hZ2VEZWZzLncpLmF0dHIoJ2hlaWdodCcsIG1lLmltYWdlRGVmcy5oKVxyXG4gICAgICAgIC8vIC5hdHRyKCdzdHJva2UnLCAnYmx1ZScpLmF0dHIoJ3N0cm9rZS13aWR0aCcsIDEpXHJcbiAgICAgICAgLmF0dHIoJ2ZpbGwnLCBkID0+IGB1cmwoI2ltZy0ke2QuZGF0YS5ub2RlSWR9KWApLmF0dHIoJ3J4JywgbWUuaW1hZ2VEZWZzLnJ4KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHh4eGRyYXdOb2RlcyhcclxuICAgIHByR3JvdXA6IGQzLlNlbGVjdGlvbjxTVkdHRWxlbWVudCwgZDMuSGllcmFyY2h5UG9pbnROb2RlPElEM05vZGU+LCBhbnksIGFueT5cclxuICApIHtcclxuICAgIGNvbnN0IG1lID0gdGhpcztcclxuICAgIHByR3JvdXBcclxuICAgICAgLmFwcGVuZCgnZGVmcycpXHJcbiAgICAgIC5hcHBlbmQoJ3BhdHRlcm4nKVxyXG4gICAgICAuYXR0cignaWQnLCBkID0+IGBpbWctJHtkLmRhdGEubm9kZUlkfWApXHJcbiAgICAgIC5hdHRyKCd3aWR0aCcsIDcwKVxyXG4gICAgICAuYXR0cignaGVpZ2h0JywgNzApXHJcbiAgICAgIC5hcHBlbmQoJ2ltYWdlJylcclxuICAgICAgLmF0dHIoJ3hsaW5rOmhyZWYnLCBkID0+IGQuZGF0YS5ub2RlSW1hZ2UudXJsKVxyXG4gICAgICAuYXR0cignd2lkdGgnLCA3MClcclxuICAgICAgLmF0dHIoJ2hlaWdodCcsIDcwKTtcclxuXHJcbiAgICAvLyBhZGRpbmcgcmVjdFxyXG4gICAgcHJHcm91cC5hcHBlbmQoJ3JlY3QnKS5hdHRyKCdjbGFzcycsICdub2RlLXJlY3QnKVxyXG4gICAgICAuYXR0cignd2lkdGgnLCBtZS53aWR0aCkuYXR0cignaGVpZ2h0JywgbWUuaGVpZ2h0KVxyXG4gICAgICAuYXR0cignc3Ryb2tlJywgJ2JsdWUnKS5hdHRyKCdzdHJva2Utd2lkdGgnLCAxKVxyXG4gICAgICAuYXR0cignZmlsbCcsICdncmF5JykuYXR0cigncngnLCAxMik7XHJcblxyXG4gICAgLy8gYWRkaW5nIHRpdGxlXHJcbiAgICBwckdyb3VwLmFwcGVuZCgndGV4dCcpLnRleHQoZCA9PiBkLmRhdGEudGl0bGUpXHJcbiAgICAgIC5hdHRyKCdmb250LXNpemUnLCAxMCkuYXR0cigneCcsIDcwKS5hdHRyKCd5JywgMjUpO1xyXG5cclxuICAgIC8vIGFkZGluZyBkZXNjcmlwdGlvblxyXG4gICAgcHJHcm91cC5hcHBlbmQoJ3RleHQnKS50ZXh0KGQgPT4gZC5kYXRhLmRlc2NyaXB0aW9uKVxyXG4gICAgICAuYXR0cignZm9udC1zaXplJywgMTApLmF0dHIoJ3gnLCA3MCkuYXR0cigneScsIDQ1KTtcclxuXHJcbiAgICAvLyBhZGRpbmcgaW1hZ2VcclxuICAgIHByR3JvdXAuYXBwZW5kKCdyZWN0JykuYXR0cignY2xhc3MnLCAnbm9kZS1pbWFnZScpXHJcbiAgICAgIC5hdHRyKCd4JywgNSkuYXR0cigneScsIDEwKVxyXG4gICAgICAuYXR0cignd2lkdGgnLCA1MCkuYXR0cignaGVpZ2h0JywgNTApXHJcbiAgICAgIC5hdHRyKCdmaWxsJywgZCA9PiBgdXJsKCNpbWctJHtkLmRhdGEubm9kZUlkfSlgKTtcclxuICAgIC8vIHByR3JvdXAuXHJcblxyXG4gIH1cclxuXHJcbiAgdXBkYXRlTm9kZXMocHJHcm91cDogZDMuU2VsZWN0aW9uPFNWR0dFbGVtZW50LCBhbnksIGFueSwgYW55PiwgcHJOb2RlczogZDMuSGllcmFyY2h5UG9pbnROb2RlPElEM05vZGU+W10pIHtcclxuICAgIHByR3JvdXAuc2VsZWN0KCdyZWN0Lm5vZGUtcmVjdCcpLmF0dHIoJ2ZpbGwnLCAnYmxhY2snKVxyXG4gICAgLy8gIC5lYWNoKGQgPT4ge1xyXG4gICAgLy8gICAgY29uc29sZS5sb2coJ2FyZ3VtZW50OiAnLCBkKTtcclxuICAgIC8vICB9KVxyXG5cclxuICAgIC8vLmRhdGEocHJOb2Rlcykuc2VsZWN0KCdyZWN0Lm5vZGUtcmVjdCcpXHJcbiAgICAvLy5hdHRyKCd4JywgZCA9PiBkLngpXHJcbiAgICAvLy5hdHRyKCd5JywgZCA9PiBkLnkpO1xyXG4gICAgLy8gY29uc29sZS5sb2coJ1VwZGF0ZWluZy4uLjonLCBwckdyb3VwKVxyXG4gIH1cclxuXHJcbn0iXX0=