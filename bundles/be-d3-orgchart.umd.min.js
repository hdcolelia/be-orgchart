!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("d3"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("be-d3-orgchart",["exports","@angular/core","d3","rxjs","rxjs/operators"],e):e((t=t||self)["be-d3-orgchart"]={},t.ng.core,t.d3,t.rxjs,t.rxjs.operators)}(this,(function(t,e,n,r,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function a(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,a=n.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}var i=function(){function t(){this.width=240,this.height=150}return t.prototype.prepareDefs=function(t){this.defs=t.append("defs")},t.prototype.drawNodes=function(t,e){t.data(e,(function(t){return t.id})).append("rect").attr("class","node-rect").attr("width",this.width).attr("height",this.height).attr("stroke","blue").attr("stroke-width",2).attr("fill","gray")},t.prototype.updateNodes=function(t,e){t.select("rect.node-rect").attr("fill","black")},t}(),d=function(){function t(t,e){var a,d,s=this;this.options={backgroundColor:"#03A3C5",nodeParser:new i,data:[],defaultFont:"Tahoma"},this._data=[],this.currentZoom=1,this._nodeSize={width:250,height:200},this.onNodeClick=new r.Subject;var c=this;c.container=n.select(t),(null===(a=e)||void 0===a?void 0:a.data)&&(c._data=e.data),c._nodeParser=(null===(d=e)||void 0===d?void 0:d.nodeParser)||c.options.nodeParser,c.options=Object.assign(c.options,e),r.fromEvent(window,"resize").pipe(o.debounceTime(300)).subscribe((function(){s.render()}))}return Object.defineProperty(t.prototype,"data",{get:function(){return this._data||[]},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeParser",{get:function(){return this._nodeParser},set:function(t){this._nodeParser=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeSize",{get:function(){return this._nodeSize},set:function(t){this._nodeSize=t},enumerable:!0,configurable:!0}),t.prototype.render=function(){if(this.prepareCanvas(),this.data.length)return this.prepareData(),this.showNodes(),this},t.prototype.prepareCanvas=function(){var t=this,e=this,r=e.container.node().getBoundingClientRect();e.svg=e.container.selectAll("svg").data([{id:"svg"}],(function(t){return t.id})).join((function(r){return r.append("svg").attr("class","svg-chart-container").attr("font-family",e.options.defaultFont).call(n.zoom().on("zoom",(function(e){return t.zoomed()}))).attr("cursor","move").style("background-color",e.options.backgroundColor)}),(function(t){return t.attr("width",r.width).attr("height",r.height)})),e.chart=e.svg.selectAll("g.chart").data([{id:"chart"}],(function(t){return t.id})).join((function(t){return t.append("g").attr("class","chart").attr("transform","translate(0,0)")}),(function(t){return t})),e.centerG=e.chart.selectAll("g.center-group").data([{id:"center-group"}],(function(t){return t.id})).join((function(t){return t.append("g").attr("class","center-group")}),(function(e){return e.attr("transform","translate("+r.width/2+","+t._nodeSize.height+") scale("+t.currentZoom+")")}))},t.prototype.prepareData=function(){var t=this;if(t.data.length){t.root=n.stratify().id((function(t){return t.nodeId})).parentId((function(t){return t.parentNodeId}))(t.data);var e=t.container.node().getBoundingClientRect();t.treemap=n.tree().size([e.width||250,e.height]).nodeSize([this._nodeSize.width+100,this._nodeSize.height+100]),t.allNodes=t.treemap(t.root).descendants()}},t.prototype.showNodes=function(){var t=this,e=this,n=e.treemap(e.root),r=function(t,n){return e.nodeParser.drawNodes(t,n)},o=n.descendants().filter((function(t){return!t.parent||t.parent.data.expanded})),a=function(t){return t.parent?"translate("+(t.parent.x-e.nodeParser.width/2)+","+t.parent.y+")":"translate("+(t.x-e.nodeParser.width/2)+","+t.y+")"};e.centerG.selectAll("g.node").data(o,(function(t){return t.data.nodeId})).join((function(t){return t.append("g").attr("class","node").attr("transform",a).call(r,o).on("click",(function(t){e.expand(t),e.onNodeClick.next({id:t.data.nodeId,node:t.data})}))}),(function(t){return t}),(function(t){return t.transition().duration(600).attr("transform",a).style("opacity",0).remove()})).transition().duration(600).attr("transform",(function(t){return"translate("+(t.x-e.nodeParser.width/2)+","+t.y+")"}));var i=function(n){var r={x:n.parent.x,y:n.parent.y+e.nodeParser.height};return t.diagonal(r,r)};e.centerG.selectAll("path.link").data(o.slice(1),(function(t){return t.data.nodeId})).join((function(t){return t.insert("path","g").attr("class","link").attr("fill","none").attr("stroke","blue").attr("stroke-width",2).attr("d",i)}),(function(t){return t}),(function(t){return t.transition().duration(600).attr("d",i).remove()})).transition().duration(600).attr("d",(function(n){var r={x:n.parent.x,y:n.parent.y+e.nodeParser.height};return t.diagonal(n,r)}))},t.prototype.zoomed=function(){this.lastTransform=n.event.transform,this.chart.attr("transform",this.lastTransform)},t.prototype._onNodeClick=function(t,e){this.onNodeClick.next({id:t,node:e})},t.prototype.diagonal=function(t,e){var n=t.x,r=t.y,o=e.x,a=e.y,i=o-n<0?-1:1,d=a-r<0?-1:1,s=Math.abs(o-n)/2<35?Math.abs(o-n)/2:35,c=Math.abs(a-r)/2<s?Math.abs(a-r)/2:s,l=Math.abs(a-r)/2-c;return"\n            M "+n+" "+r+"\n            L "+n+" "+(r+l*d)+"\n            C  "+n+" "+(r+l*d+c*d)+" "+n+" "+(r+l*d+c*d)+" "+(n+c*i)+" "+(r+l*d+c*d)+"\n            L "+(n+(Math.abs(o-n)-2*c)*i+c*i)+" "+(r+l*d+c*d)+"\n            C "+o+"  "+(r+l*d+c*d)+" "+o+"  "+(r+l*d+c*d)+" "+o+" "+(a-l*d)+"\n            L "+o+" "+a+"\n          "},t.prototype.expand=function(t){var e=t.data.expanded;t.data.expanded=!e;var n=function(t,e){(t||[]).forEach((function(t){t.data.hidden=!e,n(t.children,e)}))};n(t.children,e),this.render()},t}();function s(t,n){1&t&&(e["ɵɵnamespaceSVG"](),e["ɵɵelementStart"](0,"svg",4),e["ɵɵelement"](1,"path",5),e["ɵɵelement"](2,"path",6),e["ɵɵelement"](3,"path",7),e["ɵɵelement"](4,"path",8),e["ɵɵelementStart"](5,"g",9),e["ɵɵelement"](6,"circle",10),e["ɵɵelement"](7,"circle",11),e["ɵɵelement"](8,"circle",12),e["ɵɵelementEnd"](),e["ɵɵelementStart"](9,"g",13),e["ɵɵelementStart"](10,"text",14),e["ɵɵtext"](11,"A"),e["ɵɵelementEnd"](),e["ɵɵelementStart"](12,"text",15),e["ɵɵtext"](13,"B"),e["ɵɵelementEnd"](),e["ɵɵelementStart"](14,"text",16),e["ɵɵtext"](15,"C"),e["ɵɵelementEnd"](),e["ɵɵelementEnd"](),e["ɵɵelementEnd"]())}function c(t,n){1&t&&(e["ɵɵelementStart"](0,"div"),e["ɵɵelementStart"](1,"p"),e["ɵɵtext"](2,"$$title"),e["ɵɵelementEnd"](),e["ɵɵelementStart"](3,"p"),e["ɵɵtext"](4,"$$id"),e["ɵɵelementEnd"](),e["ɵɵelementEnd"]())}var l=function(){function t(t){this.prEl=t}return Object.defineProperty(t.prototype,"chart",{get:function(){var t=this;if(!t._chart){var e={};t.nodes&&(e.data=t.nodes),t.nodeParser&&(e.nodeParser=t.nodeParser),t._chart=new d(this.prEl.nativeElement,e)}return t._chart},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){this.init()},t.prototype.ngOnChanges=function(t){t.nodeParser&&t.nodeParser.currentValue&&(this.assignNodeParser(t.nodeParser.currentValue),this.chart.render()),t.nodes&&t.nodes.currentValue&&(this.assignData(t.nodes.currentValue),this.chart.render())},t.prototype.init=function(){this.chart;this.chart.render(),this.chart.onNodeClick.subscribe((function(t){console.log("Clicked: ",t)}))},t.prototype.assignData=function(t,e){void 0===e&&(e=!0);var n=this.chart;t instanceof Array||(t=[t]),e?n.data=t:(n.data=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t}(n.data,t),n.render())},t.prototype.assignNodeParser=function(t){var e=this.chart;e.nodeParser=t,e.render()},t.ɵfac=function(n){return new(n||t)(e["ɵɵdirectiveInject"](e.ElementRef))},t.ɵcmp=e["ɵɵdefineComponent"]({type:t,selectors:[["be-d3-orgchart"]],inputs:{nodes:"nodes",nodeParser:"nodeParser"},features:[e["ɵɵNgOnChangesFeature"]],decls:6,vars:0,consts:[[1,"container"],["orgchart",""],["defaultTemplate",""],["nodeTemplate",""],["height","400","width","450"],["id","lineAB","d","M 100 350 l 150 -300","stroke","red","stroke-width","3","fill","none"],["id","lineBC","d","M 250 50 l 150 300","stroke","red","stroke-width","3","fill","none"],["d","M 175 200 l 150 0","stroke","green","stroke-width","3","fill","none"],["d","M 100 350 q 150 -300 300 0","stroke","blue","stroke-width","5","fill","none"],["stroke","black","stroke-width","3","fill","black"],["id","pointA","cx","100","cy","350","r","3"],["id","pointB","cx","250","cy","50","r","3"],["id","pointC","cx","400","cy","350","r","3"],["font-size","30","font-family","sans-serif","fill","black","stroke","none","text-anchor","middle"],["x","100","y","350","dx","-30"],["x","250","y","50","dy","-10"],["x","400","y","350","dx","30"]],template:function(t,n){1&t&&(e["ɵɵelement"](0,"div",0,1),e["ɵɵtemplate"](2,s,16,0,"ng-template",null,2,e["ɵɵtemplateRefExtractor"]),e["ɵɵtemplate"](4,c,5,0,"ng-template",null,3,e["ɵɵtemplateRefExtractor"]))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}image.rounded[_ngcontent-%COMP%]{border-radius:50%;border-color:#00f;border-width:2px}"]}),t}(),u=function(){function t(){}return t.ɵmod=e["ɵɵdefineNgModule"]({type:t}),t.ɵinj=e["ɵɵdefineInjector"]({factory:function(e){return new(e||t)},imports:[[]]}),t}();("undefined"==typeof ngJitMode||ngJitMode)&&e["ɵɵsetNgModuleScope"](u,{declarations:[l],exports:[l]}),t.BED3OrgchartComponent=l,t.BED3OrgchartModule=u,t.NodeItemParser=i,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=be-d3-orgchart.umd.min.js.map